<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en"><generator uri="https://jekyllrb.com/" version="4.3.3">Jekyll</generator><link href="https://cainefm.github.io/feed.xml" rel="self" type="application/atom+xml"/><link href="https://cainefm.github.io/" rel="alternate" type="text/html" hreflang="en"/><updated>2025-12-18T13:28:59+00:00</updated><id>https://cainefm.github.io/feed.xml</id><title type="html">blank</title><subtitle>Personal webpage for Fan Min. </subtitle><entry><title type="html">A understanding of Immortal time bias when doing a research</title><link href="https://cainefm.github.io/blog/2025/Immortal-time-bias/" rel="alternate" type="text/html" title="A understanding of Immortal time bias when doing a research"/><published>2025-01-18T15:59:00+00:00</published><updated>2025-01-18T15:59:00+00:00</updated><id>https://cainefm.github.io/blog/2025/Immortal-time-bias</id><content type="html" xml:base="https://cainefm.github.io/blog/2025/Immortal-time-bias/"><![CDATA[<h1 id="immortal-time-bias">Immortal Time Bias</h1> <h2 id="abbreviations">Abbreviations</h2> <ul> <li><strong>Rx</strong>: prescription</li> <li><strong>Dx</strong>: diagnosis</li> <li><strong>FU</strong>: follow-up</li> <li><strong>Index date</strong>: day 0, start of observation</li> </ul> <h2 id="key-points">Key Points</h2> <ol> <li> <p><strong>Equal criteria for groups</strong><br/> It is crucial to apply consistent criteria for both the treatment and control groups. For example, the follow-up should start at the same point for both groups to avoid biases.</p> </li> <li> <p><strong>Define exposure with pre-index information</strong><br/> Defining exposure status based on characteristics after the index date can lead to biases.</p> </li> </ol> <h2 id="definition">Definition</h2> <p><a href="https://academic-oup-com/aje/article/167/4/492/233064?login=false">Immortal time bias</a> is a span of cohort follow-up during which, because of exposure definition, the outcome under study could not occur.</p> <p>Most of this bias would not be observed in an active comparator new user design. In other words, immortal time bias usually exists in studies that: (1) lack an active comparator, or (2) include prevalent users. It is also common when exploring combination therapy.</p> <h2 id="scenarios-leading-to-immortal-time-bias">Scenarios Leading to Immortal Time Bias</h2> <h3 id="1-inconsistent-follow-up-rules-between-groups">1. Inconsistent follow-up rules between groups</h3> <p>We should use one set of rules, not two different rules, for exposure and control groups. For example, if follow-up starts from treatment initiation in the exposure group but from diagnosis in the control group, this creates bias. <a href="https://www-bmj-com/content/340/bmj.b5087">Reference</a></p> <p>For instance, if patients in the treatment group are required to survive until their first prescription, they may inherently be healthier than those in the untreated group. This can skew results and lead to incorrect conclusions about the effectiveness of treatments.</p> <h3 id="2-event-based-cohort-definition">2. Event-based cohort definition</h3> <p><a href="https://academic-oup-com/aje/article/167/4/492/233064?login=false">Event-based cohort definition</a> can create traditional immortal time bias. Starting the observation from the diagnosis date in both groups can lead to bias because the time period from follow-up initiation to first prescription is wrongly classified as a treated period.</p> <h3 id="3-time-based-index-date-definition">3. Time-based index date definition</h3> <p><a href="https://academic-oup-com/aje/article/167/4/492/233064?login=false">Time-based index date definition</a>: Using administrative or arbitrary dates as the index date (e.g., database entry date, calendar date) for both groups can cause prevalent user bias or immortal time bias. <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8087121/">Reference</a></p> <p>In this scenario, some patients who experienced the outcome or death before follow-up initiation were excluded, and those drug effects are cumulative effects, which may lead to prevalent user bias.</p> <h3 id="4-exposure-based-cohorts">4. Exposure-based cohorts</h3> <p>According to Suissa’s description, another type of issue comes from <a href="https://academic-oup-com/aje/article/167/4/492/233064?login=false">exposure-based cohorts</a>. In a <a href="https://erj.ersjournals.com/content/20/4/819.short">study</a> comparing combination therapies to single therapies, the index date for combination therapies is the time point of the second drug initiation. This requires patients to survive until the initiation of the second drug, which can lead to immortal time bias, as only healthier individuals who can tolerate the first drug will be included.</p> <h2 id="solutions">Solutions</h2> <ol> <li> <p><strong>Random assignment of index date</strong> is inappropriate. However, assigning an index date for the non-user group and matching with the same diagnosis-to-prescription distribution is acceptable. <a href="https://academic.oup.com/aje/article/162/10/1016/65057?login=false">Reference: five method comparison</a></p> </li> <li> <p><strong>Landmark analysis</strong> may fix immortal time bias, but it introduces prevalent user bias.</p> </li> <li> <p><strong><a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8087121/">Time-varying exposure</a></strong>: Classify the immortal time as unexposed prior to the prescription using either a <a href="https://academic-oup-com/aje/article/167/4/492/233064?login=false">Poisson model approach or a Cox proportional hazards model with a time-dependent definition for drug exposure</a>.</p> </li> <li> <p><strong><a href="https://academic.oup.com/aje/article/162/10/1016/65057?login=false">Time-dependent variable</a></strong>: Start follow-up at diagnosis. A new variable is defined as 0 before the time of first prescription and changes to 1 when the prescription is filled and onward for users. For non-users, the value remains 0 throughout the follow-up.</p> </li> <li> <p><strong><a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8087121/">Grace period with inverse probability of censoring weights (IPCW)</a></strong></p> </li> <li> <p><strong><a href="https://www-bmj-com/content/340/bmj.b5087.long">Time-matched, nested case-control analysis</a></strong></p> </li> <li> <p><strong>Sequential trials</strong> may be more efficient from a statistical perspective. <a href="https://doi.org/10.1093/aje/kwv254">Reference: time-to-event analysis</a></p> </li> </ol>]]></content><author><name></name></author><category term="epi"/><summary type="html"><![CDATA[Immortal time bias]]></summary></entry><entry><title type="html">Causal inference from CAUSALab</title><link href="https://cainefm.github.io/blog/2023/casualab/" rel="alternate" type="text/html" title="Causal inference from CAUSALab"/><published>2023-08-20T15:59:00+00:00</published><updated>2023-08-20T15:59:00+00:00</updated><id>https://cainefm.github.io/blog/2023/casualab</id><content type="html" xml:base="https://cainefm.github.io/blog/2023/casualab/"><![CDATA[<p>As researchers in the medical world, we strive to understand not just what’s happening, but <em>why</em> it’s happening.</p> <p>We want to identify the true causes of diseases and health outcomes so we can develop effective interventions. Most of my previous research has relied on observational studies using existing databases. I’ve often been limited to interpreting associations rather than causality, due to the possibility of unmeasured factors. However, I’ve come to realize that providing causal inference, rather than just association, is essential for patients and clinicians. This allows us to identify interventions that can truly benefit patients, rather than simply pointing to potential associations that might not translate into real-world improvements.</p> <p>However, it’s a constant challenge to establish causal relationships in the real world. While randomized controlled trials (RCTs) are the gold standard for proving causality, they are often impractical or even impossible to conduct. However, there is a growing body of observational research that aims to mimic RCTs and explore causal inference. One prominent theory is the counterfactual framework developed by CAUSALab at Harvard.</p> <p>It’s important to note that I don’t view causal inference as the only valuable type of research in the medical world. Traditional association studies still provide valuable insights and can generate hypotheses for further investigation. In reality, some information, though not necessarily key factors, may be missing in existing databases, which is not a reason to stop conducting research. By thinking from a causal inference perspective from the very beginning, we can design studies that better isolate the true impact of specific factors. It helps us to frame our research questions more effectively and to interpret the results with a deeper understanding of the underlying mechanisms.</p> <p>This post will summarize the key ideas and methods presented in the book “What If,” which explores this exciting new frontier in causal inference.</p>]]></content><author><name></name></author><category term="epi"/><summary type="html"><![CDATA[A brief introduction to causal inference learned from CAUSALab]]></summary></entry><entry><title type="html">Two regression based methods for interrupted time series</title><link href="https://cainefm.github.io/blog/2020/ITS-study-test-two-model/" rel="alternate" type="text/html" title="Two regression based methods for interrupted time series"/><published>2020-12-23T00:00:00+00:00</published><updated>2020-12-23T00:00:00+00:00</updated><id>https://cainefm.github.io/blog/2020/ITS-study-test-two-model</id><content type="html" xml:base="https://cainefm.github.io/blog/2020/ITS-study-test-two-model/"><![CDATA[<h2 id="background">Background</h2> <p>Interrupted time series (ITS) analysis is a powerful quasi-experimental study design for evaluating the effectiveness of population-level health interventions that have been implemented at a clearly defined point in time. We have conducted and published an <a href="https://pubmed.ncbi.nlm.nih.gov/33858719/">exploration of the effectiveness of PCV vaccines in Hong Kong using this method</a>.</p> <p>The core of ITS analysis is the segmented regression model. Some people may argue that this regression-based method is not perfect because it lacks the ability to account for autocorrelation and seasonality. We are not going to discuss this in this article. In the current article, I want to discuss the issue in the widely adopted two regression-based methods.</p> <p><strong>Updated: The author has updated and made corrections to these methods at the time of writing.</strong></p> <p>Two approaches are widely adopted by <a href="https://pubmed.ncbi.nlm.nih.gov/27283160-interrupted-time-series-regression-for-the-evaluation-of-public-health-interventions-a-tutorial/">JLB 2017</a> and <a href="https://pubmed.ncbi.nlm.nih.gov/12174032-segmented-regression-analysis-of-interrupted-time-series-studies-in-medication-use-research/">AKD 2002</a>.</p> <p>The core of ITS analysis is the segmented regression model, which can be expressed in two slightly different formulations based on the JLB 2017 and AKD 2002 papers:</p> <p>JLB 2017 <strong>interactive</strong> formulation: \(Y_t = \beta_{0} + \beta_{1} \cdot time_t + \beta_{2} \cdot intervention_t + \beta_{3} \cdot time \cdot intervention_t\)</p> <p>where</p> <ul> <li>$Y_t$ is the outcome variable at time $t$</li> <li>$time_t$ is the time since the start of the study</li> <li>$intervention_t$ is a dummy variable indicating the pre- or post-intervention period</li> <li>$(time_t - time_of_intervention) \cdot intervention_t$ is the interaction term representing the change in slope after the intervention</li> </ul> <p>The interpretation of parameters in the original paper</p> <p><img src="/assets/img/its/Capture3.PNG" alt=""/></p> <hr/> <p>and the dataset looked like:</p> <p><img src="/assets/img/its/Capture1.PNG" alt=""/></p> <hr/> <p>while the formula in the AKD’s <strong>additional model</strong>:</p> \[Y_t = \beta_{0} + \beta_{1} \cdot Time_t + \beta_{2} \cdot Intervention_t + \beta_{3} \cdot NewTimeAfterIntervention_t\] <ul> <li>Where the terms are similar, but the interaction term $(time_t - time_of_intervention) \cdot intervention_t$ is replaced with $time_after_intervention_t$.</li> </ul> <p>And the interpretation of parameters in original article</p> <p><img src="/assets/img/its/Capture4.PNG" alt=""/></p> <hr/> <p>and the dataset looks like:</p> <p><img src="/assets/img/its/Capture2.PNG" alt=""/></p> <hr/> <p>The textbook for ITS is the JLB’s tutorial <a href="https://pubmed.ncbi.nlm.nih.gov/27283160-interrupted-time-series-regression-for-the-evaluation-of-public-health-interventions-a-tutorial/">《Interrupted time series regression for the evaluation of public health interventions: a tutorial》</a>. When I dug deeper, I found the ultimate reference was the AKD article from 2002 <a href="https://pubmed.ncbi.nlm.nih.gov/12174032-segmented-regression-analysis-of-interrupted-time-series-studies-in-medication-use-research/">《Segmented regression analysis of interrupted time series studies in medication use research》</a>. However, the formulas used in these two papers have a slight difference.</p> <hr/> <h3 id="the-difference-between-two-models">The difference between two models</h3> <h4 id="generate-a-dataset">Generate a dataset</h4> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s1">'ggplot2'</span><span class="p">)</span><span class="w">
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">999</span><span class="p">)</span><span class="w">
</span><span class="n">testdf</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">outcome</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ceiling</span><span class="p">(</span><span class="n">runif</span><span class="p">(</span><span class="m">100</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">100</span><span class="p">)),</span><span class="n">Time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="n">PCV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">70</span><span class="p">),</span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">30</span><span class="p">)),</span><span class="n">NewTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">70</span><span class="p">),</span><span class="m">1</span><span class="o">:</span><span class="m">30</span><span class="p">))</span><span class="w">
</span><span class="n">testdf</span><span class="w">
</span></code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##     outcome Time PCV NewTime
## 1        40    1   0       0
## 2        59    2   0       0
## 3        11    3   0       0
## 4        86    4   0       0
## 5        79    5   0       0
## 6        13    6   0       0
## 7        62    7   0       0
## 8        10    8   0       0

## 95       52   95   1      25
## 96       18   96   1      26
## 97       73   97   1      27
## 98       51   98   1      28
## 99       50   99   1      29
## 100      90  100   1      30
</code></pre></div></div> <h4 id="model-with-interaction-term">Model with interaction term</h4> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">test1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">glm</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">testdf</span><span class="p">,</span><span class="n">outcome</span><span class="o">~</span><span class="n">Time</span><span class="o">+</span><span class="n">PCV</span><span class="o">+</span><span class="n">Time</span><span class="o">*</span><span class="n">PCV</span><span class="p">)</span><span class="w">
</span><span class="n">coef</span><span class="p">(</span><span class="n">test1</span><span class="p">)</span><span class="w">
</span></code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## (Intercept)        Time         PCV    Time:PCV
##  44.3055901   0.2264019 -69.8521232   0.5827194
</code></pre></div></div> <h4 id="model-with-additional-term">Model with additional term</h4> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">test2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">glm</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">testdf</span><span class="p">,</span><span class="n">outcome</span><span class="o">~</span><span class="n">Time</span><span class="o">+</span><span class="n">PCV</span><span class="o">+</span><span class="n">NewTime</span><span class="p">)</span><span class="w">
</span><span class="n">coef</span><span class="p">(</span><span class="n">test2</span><span class="p">)</span><span class="w">
</span></code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## (Intercept)        Time         PCV     NewTime
##  44.3055901   0.2264019 -29.0617683   0.5827194
</code></pre></div></div> <p>The two papers, JLB 2017 and AKD 2002, both highlight that the key parameter of interest is the change in slope after the intervention. However, the specific formulations and the resulting numerical estimates for this slope change parameter are quite different between the two papers.</p> <p>This discrepancy in the slope change estimates is puzzling to me. One possibility is that one of the formulations may be incorrect or inappropriate. Alternatively, as I mentioned, we may need to consider some adjustments to the models, as Dr. Qiu suggested in the WeChat group discussion.</p> <p>Another observation I make is that even when using the “slope-only” model as outlined in the JLB 2017 method, I often observe a significant level change parameter ($\beta_2$). This seems counterintuitive to me, as the slope-only model is intended to capture only the change in slope, not the level.</p> <p>Given these concerns, I am hesitant to outright state that the JLB 2017 method is wrong. However, I believe that the JLB 2017 formulation may not be the most appropriate for a pure slope-only model. I suggest we should be cautious in interpreting the level change parameter ($\beta_2$) from this method, as it may not be meaningful or reliable in the context of a slope-only intervention analysis.</p> <p>Overall, my perspective is that the differences in the slope change estimates between the two papers, as well as the potential issues with interpreting the level change parameter in the JLB 2017 method, warrant further investigation and careful consideration before drawing conclusions about the intervention effect.</p> <hr/> <h3 id="slope-only-model-in-two-method">Slope-only model in two method</h3> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">test3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">glm</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">testdf</span><span class="p">,</span><span class="n">outcome</span><span class="o">~</span><span class="n">Time</span><span class="o">+</span><span class="n">Time</span><span class="o">:</span><span class="n">PCV</span><span class="p">)</span><span class="w">
</span><span class="n">coef</span><span class="p">(</span><span class="n">test3</span><span class="p">)</span><span class="w">
</span></code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## (Intercept)        Time    Time:PCV
##  43.0861172   0.2523481  -0.2378050
</code></pre></div></div> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">test4</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">glm</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">testdf</span><span class="p">,</span><span class="n">outcome</span><span class="o">~</span><span class="n">Time</span><span class="o">+</span><span class="n">NewTime</span><span class="p">)</span><span class="w">
</span><span class="n">coef</span><span class="p">(</span><span class="n">test4</span><span class="p">)</span><span class="w">
</span></code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## (Intercept)        Time     NewTime
##  48.5384253   0.0475497  -0.2601473
</code></pre></div></div> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">predicted_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">outcome_pred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">test3</span><span class="p">,</span><span class="n">testdf</span><span class="p">),</span><span class="n">Time</span><span class="o">=</span><span class="n">testdf</span><span class="o">$</span><span class="n">Time</span><span class="p">)</span><span class="w">
</span><span class="n">predicted_df2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">outcome_pred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">test4</span><span class="p">,</span><span class="n">testdf</span><span class="p">),</span><span class="n">Time</span><span class="o">=</span><span class="n">testdf</span><span class="o">$</span><span class="n">Time</span><span class="p">,</span><span class="n">NewTime</span><span class="o">=</span><span class="n">testdf</span><span class="o">$</span><span class="n">NewTime</span><span class="p">)</span><span class="w">
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">testdf</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">outcome</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_point</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_line</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predicted_df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">outcome_pred</span><span class="p">))</span><span class="o">+</span><span class="w">
    </span><span class="n">geom_line</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">,</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predicted_df2</span><span class="p">,</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Time</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">outcome_pred</span><span class="p">))</span><span class="w">
</span></code></pre></div></div> <p><img src="/assets/img/its/unnamed-chunk-4-1.png" alt=""/></p> <h4 id="fixed-the-previous-problem-by-changing-the-time">Fixed the previous problem by changing the time</h4> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">test5</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">glm</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">testdf</span><span class="p">,</span><span class="n">outcome</span><span class="o">~</span><span class="n">Time</span><span class="o">+</span><span class="n">NewTime</span><span class="o">:</span><span class="n">PCV</span><span class="p">)</span><span class="w">
</span><span class="n">coef</span><span class="p">(</span><span class="n">test5</span><span class="p">)</span><span class="w">
</span></code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## (Intercept)        Time NewTime:PCV
##  48.5384253   0.0475497  -0.2601473
</code></pre></div></div> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">predicted_df3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">outcome_pred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">test5</span><span class="p">,</span><span class="n">testdf</span><span class="p">),</span><span class="n">Time</span><span class="o">=</span><span class="n">testdf</span><span class="o">$</span><span class="n">Time</span><span class="p">,</span><span class="n">NewTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">testdf</span><span class="o">$</span><span class="n">NewTime</span><span class="p">)</span><span class="w">

</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">testdf</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">outcome</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_point</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_line</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predicted_df3</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">outcome_pred</span><span class="p">))</span><span class="w">
</span></code></pre></div></div> <p><img src="/assets/img/its/unnamed-chunk-5-1.png" alt=""/></p> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">testdf</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">outcome</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_point</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_line</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">,</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predicted_df2</span><span class="p">,</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Time</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">outcome_pred</span><span class="p">))</span><span class="w">
</span></code></pre></div></div> <p><img src="/assets/img/its/unnamed-chunk-5-2.png" alt=""/></p> <hr/> <h3 id="apply-to-our-dataset">Apply to our dataset</h3> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s1">'stdpm.csv'</span><span class="p">)</span><span class="w">
</span><span class="n">df</span><span class="o">$</span><span class="n">NewTime</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">69</span><span class="p">),</span><span class="m">1</span><span class="o">:</span><span class="p">(</span><span class="m">166-69</span><span class="p">))</span><span class="w">
</span><span class="n">df</span><span class="w">
</span></code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##       X year month pneu_ad  stdpop time pcv pcv.lag1 pcv.lag3 pcv.lag6 pcv.lag9
## 1     1 2004     1    1562 5514526    1   0        0        0        0        0
## 2     2 2004     2    2272 5564488    2   0        0        0        0        0
## 3     3 2004     3    2343 5609644    3   0        0        0        0        0
## 4     4 2004     4    2569 5568791    4   0        0        0        0        0
## 5     5 2004     5    2500 5585966    5   0        0        0        0        0
## 6     6 2004     6    2626 5559820    6   0        0        0        0        0

## 163 163 2017     7    4840 9013479  163   1        1        1        1        1
## 164 164 2017     8    3913 9070214  164   1        1        1        1        1
## 165 165 2017     9    3602 8957569  165   1        1        1        1        1
## 166 166 2017    10    3650 9032499  166   1        1        1        1        1
##         rate      lag NewTime
## 1   2.832519       NA       0
## 2   4.083035 7.353722       0
## 3   4.176736 7.728416       0
## 4   4.613210 7.759187       0
## 5   4.475501 7.851272       0
## 6   4.723174 7.824046       0

## 163 5.369736 8.396155      94
## 164 4.314121 8.484670      95
## 165 4.021180 8.272060      96
## 166 4.040964 8.189245      97
</code></pre></div></div> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Interaction.model</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">glm</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span><span class="n">pneu_ad</span><span class="o">~</span><span class="n">time</span><span class="o">+</span><span class="n">time</span><span class="o">:</span><span class="n">pcv</span><span class="p">)</span><span class="w">
</span><span class="n">coef</span><span class="p">(</span><span class="n">Interaction.model</span><span class="p">)</span><span class="w">
</span></code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## (Intercept)        time    time:pcv
## 2836.755182    2.976605    6.849634
</code></pre></div></div> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Interaction.model.adj</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">glm</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span><span class="n">pneu_ad</span><span class="o">~</span><span class="n">time</span><span class="o">+</span><span class="n">NewTime</span><span class="o">:</span><span class="n">pcv</span><span class="p">)</span><span class="w">
</span><span class="n">coef</span><span class="p">(</span><span class="n">Interaction.model.adj</span><span class="p">)</span><span class="w">
</span></code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## (Intercept)        time NewTime:pcv
## 2437.493871   15.776112   -6.887371
</code></pre></div></div> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Additional.model</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">glm</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span><span class="n">pneu_ad</span><span class="o">~</span><span class="n">time</span><span class="o">+</span><span class="n">NewTime</span><span class="p">)</span><span class="w">
</span><span class="n">coef</span><span class="p">(</span><span class="n">Additional.model</span><span class="p">)</span><span class="w">
</span></code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## (Intercept)        time     NewTime
## 2437.493871   15.776112   -6.887371
</code></pre></div></div> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">predicted_df.in</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">outcome_pred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">Interaction.model</span><span class="p">,</span><span class="n">df</span><span class="p">),</span><span class="n">Time</span><span class="o">=</span><span class="n">df</span><span class="o">$</span><span class="n">time</span><span class="p">)</span><span class="w">

</span><span class="n">predicted_df.in.adj</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">outcome_pred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">Interaction.model.adj</span><span class="p">,</span><span class="n">df</span><span class="p">),</span><span class="n">Time</span><span class="o">=</span><span class="n">df</span><span class="o">$</span><span class="n">time</span><span class="p">)</span><span class="w">

</span><span class="n">predicted_df.ad</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">outcome_pred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">Additional.model</span><span class="p">,</span><span class="n">df</span><span class="p">),</span><span class="n">Time</span><span class="o">=</span><span class="n">df</span><span class="o">$</span><span class="n">time</span><span class="p">,</span><span class="n">NewTime</span><span class="o">=</span><span class="n">df</span><span class="o">$</span><span class="n">NewTime</span><span class="p">)</span><span class="w">


</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">,</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pneu_ad</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_point</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_line</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predicted_df.in</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">outcome_pred</span><span class="p">))</span><span class="o">+</span><span class="w">
    </span><span class="n">ggtitle</span><span class="p">(</span><span class="s1">'JBL model'</span><span class="p">)</span><span class="w">
</span></code></pre></div></div> <p><img src="/assets/img/its/unnamed-chunk-8-1.png" alt=""/></p> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">,</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pneu_ad</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_point</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_line</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predicted_df.in.adj</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">outcome_pred</span><span class="p">))</span><span class="o">+</span><span class="w">
    </span><span class="n">ggtitle</span><span class="p">(</span><span class="s1">'JBL adjusted model'</span><span class="p">)</span><span class="w">
</span></code></pre></div></div> <p><img src="/assets/img/its/unnamed-chunk-8-2.png" alt=""/></p> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">,</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pneu_ad</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_point</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_line</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">,</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predicted_df.ad</span><span class="p">,</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Time</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">outcome_pred</span><span class="p">))</span><span class="o">+</span><span class="w">
    </span><span class="n">ggtitle</span><span class="p">(</span><span class="s1">'AKD model'</span><span class="p">)</span><span class="w">
</span></code></pre></div></div> <p><img src="/assets/img/its/unnamed-chunk-8-3.png" alt=""/></p> <h3 id="limitation">Limitation</h3> <h4 id="poisson-regression-should-be-used-for-count-data-rather-than-linear-regression-i-have-not-added-offset-and-deseasonalized-terms-in-the-model">Poisson regression should be used for count data rather than linear regression. I have not added offset and deseasonalized terms in the model.</h4> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### 4.3 Model with additional term</span><span class="w">
</span><span class="n">testtesttest</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">testdf</span><span class="p">[</span><span class="n">testdf</span><span class="o">$</span><span class="n">PCV</span><span class="o">==</span><span class="m">0</span><span class="p">,],</span><span class="n">outcome</span><span class="o">~</span><span class="n">Time</span><span class="p">)</span><span class="w">
</span><span class="n">coef</span><span class="p">(</span><span class="n">testtesttest</span><span class="p">)</span><span class="w">
</span></code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## (Intercept)        Time
##  44.3055901   0.2264019
</code></pre></div></div> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">testtesttest</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">testdf</span><span class="p">[</span><span class="n">testdf</span><span class="o">$</span><span class="n">PCV</span><span class="o">==</span><span class="m">1</span><span class="p">,],</span><span class="n">outcome</span><span class="o">~</span><span class="n">Time</span><span class="p">)</span><span class="w">
</span><span class="n">coef</span><span class="p">(</span><span class="n">testtesttest</span><span class="p">)</span><span class="w">
</span></code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## (Intercept)        Time
## -25.5465332   0.8091212
</code></pre></div></div>]]></content><author><name>FAN Min</name></author><category term="epi"/><summary type="html"><![CDATA[Background]]></summary></entry></feed>